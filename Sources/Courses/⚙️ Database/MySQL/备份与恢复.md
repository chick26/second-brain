---
title: 备份与恢复
creation date: 2022-07-13 09:07 
status: done
tags:
- Sources/Courses/MySQL
- Development/Backend/Database/MySQL
---
up:: [[Sources/Courses/⚙️ Database/MySQL/• TOC for MySQL Course|• TOC for MySQL Course]]

## 基本的术语

### 备份与恢复方式

MySQL 的备份方法可以根据不同的方式进行划分。例如，根据备份的方法可以划分为物理备份和逻辑备份；根据备份手段、备份的数据范围及备份时数据服务是否在线等来划分，如: 根据备份的数据集的范围可以划分为全量备份、增量备份和差异备份；根据备份时数据服务是否在线可以划分为热备份和冷备份。

- 逻辑备份：表中的数据
- 物理备份：备份时直接复制备份这些数据库的文件
- 冷备份：一致性备份、脱机备份（需要停机）
- 热备份：不一致性备份、联机备份（不需要停机）
- 全量备份：备份数据库结构和文件结构
- 增量备份：仅备份自上一次完全备份或增量备份之后所增加的数据内容

## 工具使用

### Mydumper 热备份

`mydumper`，MySQL 在备份方面包含了自身的 `mysqldump` 工具，但其只支持单线程工作，这就使得它无法迅速的备份数据。而 `mydumper` 作为一个实用工具，能够良好支持多线程工作，这使得它在处理速度方面十倍于传统的 `mysqldump`。

- 轻量级 C 语言写的
- 执行速度比 `mysqldump` 快 10 倍
- 事务性和非事务性表一致的快照(适用于 0.2.2 以上版本) 
- 快速的文件压缩 
- 支持导出 binlog 多线程恢复(适用于 0.2.1 以上版本) 
- 以守护进程的工作方式，定时快照和连续二进制日志(适用于 0.5.0 以上版本) 
- 开源 (GNU GPLv3)

### XtraBackup 备份

MySQL 冷备、`mysqldump`、MySQL 热拷贝都无法实现对数据库进行增量备份。在实际生产环境中增量备份是非常实用的，如果数据大于 50G 或 100G，存储空间足够的情况下，可以每天进行完整备份，如果每天产生的数据量较大，需要定制数据备份策略。

可进行 部分备份 / 增量备份 / 流式备份

- 恢复时间相对 `mysqldump` 快很多
- 大数据量下异机恢复特别快 
- 支持增量备份恢复 
- 备份期间不间断的事务处理 
- 节省磁盘空间和网络带宽 
- 自动备份验证

## 备份方式进阶

### 可传输的表空间

与 Oracle 类似，MySQL 也支持可传输表空间。其本质就是将表空间从一个数据库拷贝到另一个库。可传输的表空间是**实现数据迁移的最佳方式**。需要注意的是，要使用 MySQL 的可传输表空间，需要将参数 `innodb_file_per_table` 设置为 `ON`。

### 闪回技术（flashback）

DBA 或开发人员，有时会误删或者误更新数据，如果是线上环境并且影响较大，就需要能快速回滚。传统恢复方法是利用备份重搭实例，再应用去除错误 sql 后的 `binlog` 来恢复数据。此法费时费力，甚至需要停机维护，并不适合快速回滚。MySQL 与 Oracle 数据库都提供了闪回技术帮助 DBA 快速恢复数据。

- Oracle：基于 `undo` 数据
- MySQL：基于 `binlog` 日志

| binlog | undo sql(撤销SQL) |
| ------ | ----------------- |
| insert | delete            |
| update | update            |
| delete | insert            |
### 利用 `binlog Server`

二进制日志（binlog）在备份中起着至关重要的作用，备份 `binlog` 文件时，只能先在本地备份,然后才能传送到远程服务器上。从 MySQL5.6 版本后，可以利用 `mysqlbinlog` 命令把远程机器的日志备份到本地目录，这样就更加方便地实现 `binlog` 日志的安全备份。